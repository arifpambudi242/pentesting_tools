import paramiko, pandas as pd

# Create an SSH client

# Load the private key
# private_key_path = '/home/iam/ubuntu19'
# private_key = paramiko.RSAKey.from_private_key_file(private_key_path)

# # Set the policy to automatically add the server's host key
# client.set_missing_host_key_policy(paramiko.AutoAddPolicy())

all_hosts = pd.read_excel('hostnames.xlsx')
# all_hosts = all_hosts['hostname'].tolist()

# # all_hosts = [f'192.168.0.{i}' for i in range(1, 254)]
# username = 'ubuntu'
# password = 'admin#1234'

for hostname in all_hosts:
    # Connect to the SSH server
    try:
        client = paramiko.SSHClient()
        host = hostname['hostname']
        username = hostname['username']
        private_key_path = hostname['path_to_pkey']
        private_key = paramiko.RSAKey.from_private_key_file(private_key_path)
        port = 22 # default port ubah jika port berbeda
        client.connect(host, username=username, pkey=private_key, port=port)
        # client.connect(hostname, 22, username, password=password, timeout=10)
        print("Connected to the server")
        # Now you can execute commands on the SSH server
        stdin, stdout, stderr = client.exec_command('id')
        print(stdout.read().decode())
    except Exception as e:
        pass
    finally:
        client.close()
        print("Connection closed")
