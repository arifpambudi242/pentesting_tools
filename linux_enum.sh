#!/bin/bash

# Judul: Linux Privilege Escalation Enumeration Script
# Deskripsi: Mengumpulkan informasi sistem dan potensi konfigurasi yang salah untuk eskalasi hak istimewa
# Penulis: Nama Anda
# Tanggal: YYYY-MM-DD

OUTPUT="enum-results.txt"
echo "############################################" > $OUTPUT
echo "[+] Mengumpulkan informasi sistem..." | tee -a $OUTPUT

echo "############################################"
echo "[+] Hostname:" | tee -a $OUTPUT
echo "############################################"
hostname | tee -a $OUTPUT

echo "############################################"
echo "[+] Informasi kernel:" | tee -a $OUTPUT
echo "############################################"
uname -a | tee -a $OUTPUT

echo "############################################"
echo "[+] Informasi rilis OS:" | tee -a $OUTPUT
echo "############################################"
cat /etc/*release | tee -a $OUTPUT

echo "############################################"
echo "[+] Pengguna saat ini:" | tee -a $OUTPUT
echo "############################################"
whoami | tee -a $OUTPUT

echo "############################################"
echo "[+] ID pengguna saat ini dan grup:" | tee -a $OUTPUT
echo "############################################"
id | tee -a $OUTPUT

echo "############################################"
echo "[+] Variabel lingkungan:" | tee -a $OUTPUT
echo "############################################"
env | tee -a $OUTPUT

echo "############################################"
echo "[+] Direktori saat ini:" | tee -a $OUTPUT
echo "############################################"
pwd | tee -a $OUTPUT

echo "############################################"
echo "[+] Isi direktori home:" | tee -a $OUTPUT
echo "############################################"
# if ENV variable $HOME is set, use that, otherwise use /home/username
# get user has home directory and save it to $user_has_home
user_has_home=$(getent passwd $USER | cut -d: -f6)
if [ -d "$user_has_home" ]; then
    ls -la $user_has_home | tee -a $OUTPUT
else
    ls -la /home/$USER | tee -a $OUTPUT
fi


read -p "Lanjutkan dengan memeriksa binary SUID? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Memeriksa binary SUID..." | tee -a $OUTPUT
    echo "############################################"
    find / -perm -4000 -type f 2>/dev/null | tee -a $OUTPUT
    echo "cari di https://gtfobins.github.io/#+suid untuk eksploitasi" | tee -a $OUTPUT    
fi
read -p "Lanjutkan dengan memeriksa binary SGID? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Memeriksa binary SGID..." | tee -a $OUTPUT
    echo "############################################"
    find / -perm -2000 -type f 2>/dev/null | tee -a $OUTPUT
    echo "cari di https://gtfobins.github.io/#+sgid untuk eksploitasi" | tee -a $OUTPUT    
fi

read -p "Lanjutkan dengan memeriksa file yang dapat ditulis oleh semua pengguna? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] File yang dapat ditulis oleh semua pengguna:" | tee -a $OUTPUT
    echo "############################################"
    find / -type f -perm -o+w 2>/dev/null | tee -a $OUTPUT
fi

# check service yang berjalan ps
read -p "Lanjutkan dengan memeriksa service yang berjalan? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Service yang berjalan:" | tee -a $OUTPUT
    echo "############################################"
    ps aux | tee -a $OUTPUT
fi

# check cron jobs
read -p "Lanjutkan dengan memeriksa cron jobs? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Cron jobs:" | tee -a $OUTPUT
    echo "############################################"
    crontab -l | tee -a $OUTPUT
fi

# check sudoers
read -p "Lanjutkan dengan memeriksa sudoers? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Sudoers:" | tee -a $OUTPUT
    echo "############################################"
    cat /etc/sudoers | tee -a $OUTPUT
fi

# check network
read -p "Lanjutkan dengan memeriksa network? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Network:" | tee -a $OUTPUT
    echo "############################################"
    netstat -antup | tee -a $OUTPUT
fi

# check installed software
read -p "Lanjutkan dengan memeriksa software yang terinstall? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Software yang terinstall:" | tee -a $OUTPUT
    echo "############################################"
    dpkg -l | tee -a $OUTPUT
fi

# check writable files
read -p "Lanjutkan dengan memeriksa file yang dapat ditulis oleh semua pengguna? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] File yang dapat ditulis oleh semua pengguna:" | tee -a $OUTPUT
    echo "############################################"
    find / -type f -perm -o+w 2>/dev/null | tee -a $OUTPUT
fi

# check history
read -p "Lanjutkan dengan memeriksa history? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] History:" | tee -a $OUTPUT
    echo "############################################"
    cat ~/.bash_history | tee -a $OUTPUT
fi

echo "############################################"
echo "[+] Enumeration selesai. Hasil disimpan di $OUTPUT."
echo "############################################"

# Opsional: Unggah hasil ke server remote (gunakan dengan hati-hati)
# scp $OUTPUT user@remote-server:/path/to/save/
