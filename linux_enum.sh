#!/bin/bash

# Judul: Linux Privilege Escalation Enumeration Script
# Deskripsi: Mengumpulkan informasi sistem dan potensi konfigurasi yang salah untuk eskalasi hak istimewa
# Penulis: Nama Anda
# Tanggal: YYYY-MM-DD

OUTPUT="enum-results.txt"

echo "[+] Mengumpulkan informasi sistem..." | tee -a $OUTPUT

echo "[+] Hostname:" | tee -a $OUTPUT
hostname | tee -a $OUTPUT

echo "[+] Informasi kernel:" | tee -a $OUTPUT
uname -a | tee -a $OUTPUT

echo "[+] Informasi rilis OS:" | tee -a $OUTPUT
cat /etc/*release | tee -a $OUTPUT

echo "[+] Pengguna saat ini:" | tee -a $OUTPUT
whoami | tee -a $OUTPUT

echo "[+] ID pengguna saat ini dan grup:" | tee -a $OUTPUT
id | tee -a $OUTPUT

echo "[+] Variabel lingkungan:" | tee -a $OUTPUT
env | tee -a $OUTPUT

echo "[+] Direktori saat ini:" | tee -a $OUTPUT
pwd | tee -a $OUTPUT

echo "[+] Isi direktori home:" | tee -a $OUTPUT
ls -la ~ | tee -a $OUTPUT

read -p "Lanjutkan dengan memeriksa binary SUID? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "[+] Memeriksa binary SUID..." | tee -a $OUTPUT
    find / -perm -4000 -type f 2>/dev/null | tee -a $OUTPUT
    echo "cari di https://gtfobins.github.io/#+suid untuk eksploitasi" | tee -a $OUTPUT    
fi
read -p "Lanjutkan dengan memeriksa binary SGID? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "[+] Memeriksa binary SGID..." | tee -a $OUTPUT
    find / -perm -2000 -type f 2>/dev/null | tee -a $OUTPUT
    echo "cari di https://gtfobins.github.io/#+sgid untuk eksploitasi" | tee -a $OUTPUT    
fi

read -p "Lanjutkan dengan memeriksa file yang dapat ditulis oleh semua pengguna? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "[+] File yang dapat ditulis oleh semua pengguna:" | tee -a $OUTPUT
    find / -type f -perm -o+w 2>/dev/null | tee -a $OUTPUT
fi

# check service yang berjalan ps
read -p "Lanjutkan dengan memeriksa service yang berjalan? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "[+] Service yang berjalan:" | tee -a $OUTPUT
    ps aux | tee -a $OUTPUT
fi

# check cron jobs
read -p "Lanjutkan dengan memeriksa cron jobs? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "[+] Cron jobs:" | tee -a $OUTPUT
    crontab -l | tee -a $OUTPUT
fi

# check sudoers
read -p "Lanjutkan dengan memeriksa sudoers? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "[+] Sudoers:" | tee -a $OUTPUT
    cat /etc/sudoers | tee -a $OUTPUT
fi

# check network
read -p "Lanjutkan dengan memeriksa network? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "[+] Network:" | tee -a $OUTPUT
    netstat -antup | tee -a $OUTPUT
fi

# check installed software
read -p "Lanjutkan dengan memeriksa software yang terinstall? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "[+] Software yang terinstall:" | tee -a $OUTPUT
    dpkg -l | tee -a $OUTPUT
fi

# check writable files
read -p "Lanjutkan dengan memeriksa file yang dapat ditulis oleh semua pengguna? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "[+] File yang dapat ditulis oleh semua pengguna:" | tee -a $OUTPUT
    find / -type f -perm -o+w 2>/dev/null | tee -a $OUTPUT
fi

# check history
read -p "Lanjutkan dengan memeriksa history? (y/n): " choice
if [ "$choice" = "y" ]; then
    echo "[+] History:" | tee -a $OUTPUT
    cat ~/.bash_history | tee -a $OUTPUT
fi

echo "[+] Enumeration selesai. Hasil disimpan di $OUTPUT."

# Opsional: Unggah hasil ke server remote (gunakan dengan hati-hati)
# scp $OUTPUT user@remote-server:/path/to/save/
